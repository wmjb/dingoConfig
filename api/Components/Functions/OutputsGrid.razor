@using domain.Devices.dingoPdm.Functions
@using domain.Devices.dingoPdm.Enums

<MudDataGrid Items="@Outputs" Dense="true" Hover="true" Striped="false" EditMode="DataGridEditMode.Cell" ReadOnly="false" 
             SortMode="SortMode.None" ColumnResizeMode="ResizeMode.Container" Virtualize="true">
    <Columns>
        <PropertyColumn Property="x => x.Number" Title="Num" Editable="false" />
        <PropertyColumn Property="x => x.Name">
            <EditTemplate>
                <MudTextField @bind-Value="context.Item.Name" Variant="Variant.Outlined" Margin="Margin.Dense" />
            </EditTemplate>
        </PropertyColumn>
        <PropertyColumn Property="x => x.Enabled">
            <EditTemplate>
                <MudCheckBox @bind-Value="context.Item.Enabled" Dense="true" />
            </EditTemplate>
        </PropertyColumn>
        <PropertyColumn Property="x => x.Input" Title="Variable">
            <EditTemplate>
                <MudSelect T="VarMap" @bind-Value="context.Item.Input" Variant="Variant.Outlined" Dense="true">
                    @foreach (VarMap varMap in Enum.GetValues(typeof(VarMap)))
                    {
                        <MudSelectItem T="VarMap" Value="@varMap">@varMap</MudSelectItem>
                    }
                </MudSelect>
            </EditTemplate>
        </PropertyColumn>
        <TemplateColumn Title="Current Limit (A)">
            <EditTemplate>
                <MudNumericField @bind-Value="@context.Item.CurrentLimit" 
                                 Min="0"
                                 Max="@((context.Item.NominalCurrentLimit * CurrentLimitMult))"
                                 Step="1.0"/>
            </EditTemplate>
        </TemplateColumn>
        <TemplateColumn Title="Inrush Limit (A)">
            <EditTemplate>
                <MudNumericField @bind-Value="@context.Item.InrushCurrentLimit" 
                                 Min="0"
                                 Max="@((context.Item.NominalCurrentLimit * InrushLimitMult))"
                                 Step="1.0"/>
            </EditTemplate>
        </TemplateColumn>
        <TemplateColumn Property="x => x.InrushTime" Title="Inrush Time (s)">
            <EditTemplate>
                <MudNumericField @bind-Value="@context.Item.InrushTime"
                                 Min ="0"
                                 Max="25"
                                 Step="1"/>
            </EditTemplate>
        </TemplateColumn>
        <PropertyColumn Property="x => x.ResetMode">
            <EditTemplate>
                <MudSelect T="ResetMode" @bind-Value="context.Item.ResetMode" Variant="Variant.Outlined" Dense="true">
                    @foreach (ResetMode resetMode in Enum.GetValues(typeof(ResetMode)))
                    {
                        <MudSelectItem T="ResetMode" Value="@resetMode">@resetMode</MudSelectItem>
                    }
                </MudSelect>
            </EditTemplate>
        </PropertyColumn>
        <PropertyColumn Property="x => x.ResetCountLimit" Title="Reset Count" />
        <PropertyColumn Property="x => x.ResetTime" Title="Reset Time (s)" />
        <PropertyColumn Property="x => x.SoftStartEnabled" Title="Soft Start">
            <EditTemplate>
                <MudCheckBox @bind-Value="context.Item.SoftStartEnabled" Dense="true" />
            </EditTemplate>
        </PropertyColumn>
        <PropertyColumn Property="x => x.VariableDutyCycle" Title="Variable PWM">
            <EditTemplate>
                <MudCheckBox @bind-Value="context.Item.VariableDutyCycle" Dense="true" />
            </EditTemplate>
        </PropertyColumn>
        <PropertyColumn Property="x => x.Frequency" Title="Freq (Hz)" />
        <PropertyColumn Property="x => x.FixedDutyCycle" Title="Duty %" />
    </Columns>
</MudDataGrid>

@code {
    [Parameter, EditorRequired]
    public List<Output> Outputs { get; set; } = null!;

    private const double CurrentLimitMult = 1.5;
    private const double InrushLimitMult = 3.0;
}
